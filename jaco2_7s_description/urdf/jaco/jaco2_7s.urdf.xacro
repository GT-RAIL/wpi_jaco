<?xml version="1.0"?>

<robot name="jaco2_7s" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:include filename="$(find jaco2_7s_description)/urdf/jaco/jaco2_7s.transmission.xacro" />
  <xacro:include filename="$(find jaco2_7s_description)/urdf/robotiq/robotiq_85_gripper.transmission.xacro" />
  <xacro:include filename="$(find jaco2_7s_description)/urdf/robotiq/robotiq_85_gripper.urdf.xacro" />

  <property name="M_PI" value="3.14159265"/>

  <xacro:macro name="jaco2_7s_arm" params="prefix parent *origin">

    <joint name="${prefix}kinova_joint" type="fixed">
      <parent link="${parent}" />
      <child link = "${prefix}base_link" />
      <xacro:insert_block name="origin"/>
    </joint>

    <link name="${prefix}base_link" >
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/base.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/base.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_1" type="continuous">
      <parent link="${prefix}base_link" />
      <child link = "${prefix}link_1" />
      <!--<origin xyz="0 0 0.15675" rpy="${M_PI} 0 ${M_PI}" />-->
      <origin xyz="0 0 0.15675" rpy="0 ${M_PI} 0" />
      <axis xyz="0 0 1" />
      <limit effort="1800.0" velocity="0.314"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_1">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/shoulder.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/shoulder.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_2" type="revolute">
      <parent link="${prefix}link_1" />
      <child link = "${prefix}link_2" />
      <!--ZERO CONFIG:<origin xyz="0 0 -0.11875" rpy="${M_PI/2} ${M_PI/2} 0" />-->
      <!--<origin xyz="0 0 -0.11875" rpy="${M_PI/2} ${-M_PI/2} 0" />-->
      <origin xyz="0 0.0016 -0.11875" rpy="-${M_PI/2} 0 ${M_PI}" />
      <axis xyz="0 0 1" />
      <!--ZERO CONFIG:<limit lower="-2.238" upper="2.238" effort="3000.5" velocity="0.314"/>-->
      <limit lower="${M_PI-2.238}" upper="${M_PI+2.238}" effort="3000.5" velocity="0.314"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_2">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/arm_half_1.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/arm_half_1.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_3" type="continuous">
      <parent link="${prefix}link_2" />
      <child link = "${prefix}link_3" />
      <origin xyz="0 -0.205 0" rpy="${M_PI/2} 0 ${M_PI}" />
      <axis xyz="0 0 1" />
      <limit effort="1800.0" velocity="0.314"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_3">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/arm_half_2.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/arm_half_2.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_4" type="revolute">
      <parent link="${prefix}link_3" />
      <child link = "${prefix}link_4" />
      <!--ZERO CONFIG:<origin xyz="0.41 0 0.00975" rpy=" 0 ${M_PI} ${M_PI}" />-->
      <!--<origin xyz="0.41 0 0.00975" rpy="0 ${M_PI} 0" />-->
      <origin xyz="0 0 -0.205" rpy="${M_PI/2} 0 ${M_PI}" />
      <axis xyz="0 0 1" />
      <!--ZERO CONFIG:<limit lower="-2.809" upper="2.809" effort="1800.0" velocity="0.314"/>-->
      <limit lower="${M_PI-2.809}" upper="${M_PI+2.809}" effort="1800.0" velocity="0.314"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_4">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/forearm.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/forearm.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_5" type="continuous">
      <parent link="${prefix}link_4" />
      <child link = "${prefix}link_5" />
      <!--<origin xyz="0.20725 0 0 " rpy="0 -${M_PI/2} 0" />-->
      <origin xyz="0 0.2073 -0.0114" rpy="${-M_PI/2} 0 ${M_PI}" />
      <axis xyz="0 0 1" />
      <limit effort="600.8" velocity="0.785"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_5">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/wrist_spherical_1.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/wrist_spherical_1.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_6" type="revolute">
      <parent link="${prefix}link_5" />
      <child link = "${prefix}link_6" />
      <origin xyz="0 0 -0.10375" rpy="${M_PI/2} 0 ${M_PI}" />
      <axis xyz="0 0 1" />
      <limit lower="${M_PI-2.25}" upper="${M_PI+2.25}" effort="600.8" velocity="0.785"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>

    <link name="${prefix}link_6">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/wrist_spherical_2.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/wrist_spherical_2.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}joint_7" type="continuous">
      <parent link="${prefix}link_6" />
      <child link = "${prefix}link_7" />
      <origin xyz="0 0.06075 0" rpy="${M_PI/2} 0 0" />
      <axis xyz="0 0 1" />
      <limit effort="600.8" velocity="0.785"/>
      <dynamics damping="0.0" friction="0.0"/>
    </joint>


    <link name="${prefix}link_7">
      <visual>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/visual/wrist_3.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://jaco2_7s_description/meshes/jaco/collision/wrist_3.stl"/>
        </geometry>
      </collision>
    </link>

    <joint name="${prefix}ee_fixed_joint" type="fixed">
      <parent link="${prefix}link_7" />
      <child link = "${prefix}ee_base" />
      <origin xyz="0 0 -0.09380704" rpy="0 ${M_PI/2} 0" /> <!--0.09380704156-->
    </joint>

    <link name="${prefix}ee_base"/>

    <!-- Add in an EEF link for the center of the gripper -->
    <joint name="${prefix}ee_gripper" type="fixed">
      <parent link="${prefix}ee_base" />
      <child link ="${prefix}ee_link" />
      <origin xyz="0.13 0 0" />
    </joint>

    <link name="${prefix}ee_link"/>

    <xacro:jaco2_7s_arm_transmission prefix="${prefix}" />

    <xacro:robotiq_85_gripper prefix="" parent="${prefix}ee_base">
      <origin xyz="0 0 0" rpy="0 0 0" />
    </xacro:robotiq_85_gripper>

    <xacro:robotiq_85_gripper_transmission prefix="" />

  </xacro:macro>
</robot>